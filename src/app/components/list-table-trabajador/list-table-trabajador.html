<app-progress-bar *ngIf="loading"></app-progress-bar>

<div *ngIf="!loading" class="container mt-4">
  <div class="title d-flex justify-content-between align-items-center mb-3">
    <h4 class="text-primary mb-0">Listado de Trabajadores</h4>
    <button type="button" class="btn btn-primary" routerLink="/trabajadores/add">
      Agregar Trabajador
    </button>
  </div>

  <table *ngIf="listTrabajadores.length > 0" class="table table-hover align-middle shadow-sm rounded">
    <thead class="table-dark text-center">
      <tr>
        <th>ID</th>
        <th>Nombre Completo</th>
        <th>Edad</th>
        <th>Teléfono</th>
        <th>Correo</th>
        <th>Ubicación</th>
        <th>Acciones</th>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngFor="let t of listTrabajadores">
        <!-- Fila principal -->
        <tr>
          <td>{{ t.id }}</td>
          <td>{{ t.nombre_completo }}</td>
          <td>{{ t.edad }}</td>
          <td>{{ t.telefono }}</td>
          <td>{{ t.correo_electronico }}</td>
          <td>{{ t.id_pais }} / {{ t.id_departamento }} / {{ t.id_municipio }}</td>
          <td class="text-center">
            <div class="btn-group">
              <button class="btn btn-info btn-sm" [routerLink]="['/trabajadores/edit', t.id]">Editar</button>
              <button class="btn btn-danger btn-sm" (click)="deleteTrabajador(t.id)">Eliminar</button>
              <button class="btn btn-secondary btn-sm" [routerLink]="['/trabajadores/asignar', t.id]">Asignar Empresa</button>
            </div>
          </td>
        </tr>

        <!-- Fila con las empresas -->
        <tr *ngIf="t.empresas?.length > 0">
          <td colspan="7" class="bg-light">
            <div class="p-2 border rounded">
              <strong>Empresas asignadas:</strong>
              <ul class="list-group list-group-flush mt-2">
                <li *ngFor="let e of t.empresas" class="list-group-item d-flex justify-content-between align-items-center">
                  {{ e.nombre_comercial }}
                  <small class="text-muted">ID: {{ e.id }}</small>
                </li>
              </ul>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <h5 *ngIf="listTrabajadores.length === 0" class="text-center text-muted mt-4">
    No hay trabajadores registrados.
  </h5>
</div>
